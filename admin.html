<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<title>‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ ‚Äî ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ï‡¶∞‡ßç‡¶§‡¶æ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</title>
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  FIREBASE CONFIG ‚Äî suraksha_v3.html-‡¶è‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶è‡¶ï‡¶á config
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script type="module">
import { initializeApp }                from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection,
         getDocs, doc, updateDoc,
         deleteDoc, serverTimestamp }   from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBkI1L32ouLDkZbQaXjR5f35HWhsVZ8Kbg",
  authDomain: "suraksha-4f141.firebaseapp.com",
  projectId: "suraksha-4f141",
  storageBucket: "suraksha-4f141.firebasestorage.app",
  messagingSenderId: "1009022095366",
  appId: "1:1009022095366:web:3e8149e8919ee7cbe4b387",
  measurementId: "G-ZD9K5ZQMKZ"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

window._fbLoadAll = async function() {
  const snap = await getDocs(collection(db, "cases"));
  return snap.docs.map(d => ({ ...d.data(), _docId: d.id }));
};

window._fbUpdateStatus = async function(caseId, status) {
  await updateDoc(doc(db, "cases", caseId), { status, updatedAt: serverTimestamp() });
};

window._fbDeleteCase = async function(caseId) {
  await deleteDoc(doc(db, "cases", caseId));
};
</script>

<!--
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  FIRESTORE SECURITY RULES ‚Äî Firebase Console-‡¶è Rules
  ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ rules ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç Publish ‡¶ï‡¶∞‡ßÅ‡¶®‡•§

  ‡¶è‡¶á rules-‡¶è:
  - User portal (v3): ‡¶∂‡ßÅ‡¶ß‡ßÅ create ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá
  - Admin panel: read + update + delete ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /cases/{caseId} {
      allow create: if true;
      allow read, update, delete: if true;
    }
  }
}

  ‚ö†Ô∏è NOTE: ‡¶â‡¶™‡¶∞‡ßá‡¶∞‡¶ü‡¶ø development-‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡•§ Production-‡¶è
  Firebase Authentication ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßá admin-only access
  ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-->

<style>
:root{--bg:#060d14;--surface:#0a1520;--card:#0e1e2e;--card2:#122030;--border:#1c3348;--border2:#254460;--teal:#0891b2;--teal2:#06b6d4;--red:#ef4444;--red2:#fca5a5;--text:#e0eaf5;--text2:#a8c0d6;--muted:#5a7a96;--mono:'JetBrains Mono',monospace;--sans:'Hind Siliguri',sans-serif;--shadow:0 8px 32px rgba(0,0,0,.4);}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:var(--sans);min-height:100vh;line-height:1.6;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(ellipse 60% 40% at 20% 20%,rgba(8,145,178,.06) 0%,transparent 70%);}
#header{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(6,13,20,.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:13px 24px;display:flex;align-items:center;gap:14px;}
.logo-mark{width:34px;height:34px;border-radius:8px;background:linear-gradient(135deg,#7c3aed,#a855f7);display:flex;align-items:center;justify-content:center;font-size:17px;}
.logo-text{font-weight:700;font-size:1rem;}
.logo-sub{font-size:.68rem;color:var(--muted);font-family:var(--mono);}
.admin-pill{margin-left:auto;display:flex;align-items:center;gap:6px;background:rgba(124,58,237,.1);border:1px solid rgba(124,58,237,.3);border-radius:20px;padding:5px 14px;font-size:.7rem;color:#c4b5fd;font-family:var(--mono);}
.gdot{width:6px;height:6px;border-radius:50%;background:#10b981;animation:pg 2s ease infinite;}
@keyframes pg{0%,100%{opacity:1;}50%{opacity:.3;}}
main{position:relative;z-index:1;padding-top:76px;max-width:980px;margin:0 auto;padding:76px 20px 60px;}
#login-screen{display:flex;align-items:center;justify-content:center;min-height:calc(100vh - 76px);}
.login-card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:36px;max-width:400px;width:100%;text-align:center;box-shadow:var(--shadow);}
.login-icon{font-size:2.8rem;margin-bottom:14px;display:block;}
.login-title{font-size:1.25rem;font-weight:700;margin-bottom:6px;}
.login-sub{font-size:.82rem;color:var(--muted);margin-bottom:24px;line-height:1.6;}
.login-input{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 15px;color:var(--text);font-family:var(--mono);font-size:.9rem;outline:none;margin-bottom:12px;letter-spacing:3px;transition:border-color .2s;}
.login-input:focus{border-color:#7c3aed;}
.login-btn{width:100%;background:linear-gradient(135deg,#7c3aed,#a855f7);border:none;border-radius:10px;padding:13px;font-family:var(--sans);font-size:.95rem;font-weight:700;color:#fff;cursor:pointer;transition:transform .2s;}
.login-btn:hover{transform:translateY(-2px);}
.login-err{color:var(--red2);font-size:.78rem;margin-top:8px;min-height:18px;}
#dashboard{display:none;}
.session-bar{display:flex;align-items:center;gap:8px;background:rgba(245,158,11,.05);border:1px solid rgba(245,158,11,.18);border-radius:9px;padding:9px 15px;font-size:.75rem;color:#fcd34d;margin-bottom:18px;flex-wrap:wrap;}
.dash-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px;}
.dash-title{font-size:1.15rem;font-weight:700;display:flex;align-items:center;gap:10px;}
.dash-actions{display:flex;gap:8px;flex-wrap:wrap;}
.btn-sm{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:7px 14px;font-size:.75rem;color:var(--text2);cursor:pointer;font-family:var(--sans);transition:all .2s;display:inline-flex;align-items:center;gap:5px;}
.btn-sm:hover{border-color:var(--teal);color:var(--text);}
.btn-danger{border-color:rgba(239,68,68,.3);color:#fca5a5;}
.btn-danger:hover{background:rgba(239,68,68,.08);border-color:rgba(239,68,68,.6);}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:12px;margin-bottom:22px;}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;text-align:center;}
.stat-num{font-size:1.8rem;font-weight:700;font-family:var(--mono);}
.stat-label{font-size:.7rem;color:var(--muted);margin-top:3px;}
.c-teal{color:var(--teal2);}.c-red{color:#ef4444;}.c-amber{color:#f87171;}.c-yel{color:#fbbf24;}
.filter-row{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;}
.filter-inp{flex:1;min-width:180px;background:var(--surface);border:1px solid var(--border);border-radius:9px;padding:9px 13px;color:var(--text);font-family:var(--sans);font-size:.85rem;outline:none;transition:border-color .2s;}
.filter-inp:focus{border-color:var(--teal);}
.filter-sel{background:var(--surface);border:1px solid var(--border);border-radius:9px;padding:9px 12px;color:var(--text2);font-family:var(--sans);font-size:.82rem;cursor:pointer;outline:none;}
.filter-sel option{background:var(--surface);}
.cases-list{display:flex;flex-direction:column;gap:10px;}
.case-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;border-left-width:3px;}
.case-card.critical{border-left-color:#ef4444;}
.case-card.high{border-left-color:#f87171;}
.case-card.medium{border-left-color:#fbbf24;}
.case-card.low{border-left-color:#6ee7b7;}
.case-hdr{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:10px;}
.case-id{font-family:var(--mono);font-size:.88rem;font-weight:700;color:var(--teal2);}
.case-ts{margin-left:auto;font-size:.67rem;color:var(--muted);font-family:var(--mono);}
.case-meta{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px;}
.meta-tag{background:var(--surface);border:1px solid var(--border);border-radius:5px;padding:2px 8px;font-size:.7rem;color:var(--text2);}
.case-footer{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;}
.rl-low{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.3);color:#6ee7b7;border-radius:5px;padding:2px 8px;font-size:.7rem;font-family:var(--mono);}
.rl-medium{background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.3);color:#fde68a;border-radius:5px;padding:2px 8px;font-size:.7rem;font-family:var(--mono);}
.rl-high{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:#fca5a5;border-radius:5px;padding:2px 8px;font-size:.7rem;font-family:var(--mono);}
.rl-critical{background:rgba(239,68,68,.25);border:1px solid rgba(239,68,68,.5);color:#fff;border-radius:5px;padding:2px 8px;font-size:.7rem;font-family:var(--mono);animation:bw 1.4s ease infinite;}
@keyframes bw{0%,100%{opacity:1;}50%{opacity:.55;}}
.tb-active{background:rgba(8,145,178,.15);color:var(--teal2);border:1px solid rgba(8,145,178,.3);border-radius:5px;padding:2px 8px;font-size:.7rem;font-family:var(--mono);}
.tb-review{background:rgba(245,158,11,.1);color:#fcd34d;border:1px solid rgba(245,158,11,.3);border-radius:5px;padding:2px 8px;font-size:.7rem;font-family:var(--mono);}
.tb-referred{background:rgba(124,58,237,.1);color:#c4b5fd;border:1px solid rgba(124,58,237,.3);border-radius:5px;padding:2px 8px;font-size:.7rem;font-family:var(--mono);}
.tb-resolved{background:rgba(16,185,129,.1);color:#86efac;border:1px solid rgba(16,185,129,.3);border-radius:5px;padding:2px 8px;font-size:.7rem;font-family:var(--mono);}
.status-sel{background:var(--surface);border:1px solid var(--border);border-radius:7px;padding:5px 10px;font-size:.75rem;color:var(--text);font-family:var(--sans);cursor:pointer;outline:none;}
.empty-state{text-align:center;padding:52px 20px;color:var(--muted);}
.empty-icon{font-size:2.5rem;display:block;margin-bottom:12px;opacity:.4;}
.loading-row{text-align:center;padding:36px;color:var(--muted);font-family:var(--mono);font-size:.82rem;}
.spin{display:inline-block;width:16px;height:16px;border-radius:50%;border:2px solid var(--border);border-top-color:var(--teal);animation:sp .7s linear infinite;vertical-align:middle;margin-right:6px;}
@keyframes sp{to{transform:rotate(360deg)}}
.config-warn{background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.25);border-radius:10px;padding:14px 18px;font-size:.8rem;color:#fcd34d;margin-bottom:18px;display:none;line-height:1.6;}
#toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(12px);background:var(--card2);border:1px solid var(--teal);border-radius:9px;padding:10px 18px;font-size:.82rem;opacity:0;transition:all .25s;z-index:500;white-space:nowrap;pointer-events:none;}
#toast.on{opacity:1;transform:translateX(-50%) translateY(0);}
@media(max-width:600px){.stats-grid{grid-template-columns:1fr 1fr;}.case-ts{display:none;}}
</style>
</head>
<body>
<div id="toast"></div>

<div id="header">
  <div class="logo-mark">‚öôÔ∏è</div>
  <div>
    <div class="logo-text">‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ï‡¶∞‡ßç‡¶§‡¶æ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</div>
    <div class="logo-sub">SURAKSHA ADMIN ¬∑ Firebase Edition</div>
  </div>
  <div class="admin-pill" id="admin-pill" style="display:none;">
    <div class="gdot"></div>‡¶∏‡ßá‡¶∂‡¶® ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º
  </div>
</div>

<main>
  <div id="login-screen">
    <div class="login-card">
      <span class="login-icon">üîê</span>
      <div class="login-title">‡¶ï‡¶∞‡ßç‡¶Æ‡¶ï‡¶∞‡ßç‡¶§‡¶æ ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤</div>
      <div class="login-sub">‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶ï‡¶∞‡ßç‡¶Æ‡¶ï‡¶∞‡ßç‡¶§‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡ßÄ‡¶Æ‡¶æ‡¶¨‡¶¶‡ßç‡¶ß‡•§<br>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ï‡ßã‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§</div>
      <input type="password" class="login-input" id="pw-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
             onkeydown="if(event.key==='Enter')doLogin()">
      <button class="login-btn" onclick="doLogin()">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶® ‚Üí</button>
      <div class="login-err" id="login-err"></div>
    </div>
  </div>

  <div id="dashboard">
    <div class="config-warn" id="config-warn">
      ‚ö†Ô∏è <strong>Firebase Config ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§</strong>
      HTML ‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶â‡¶™‡¶∞‡ßá <code>YOUR_API_KEY</code> ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase Console-‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶® ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
    </div>

    <div class="session-bar">
      ‚è± ‡¶∏‡ßá‡¶∂‡¶® ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ¬∑ <strong id="session-timer">00:00</strong>
      <span style="color:var(--muted);font-size:.7rem;">¬∑ ‡¶™‡ßá‡¶á‡¶ú ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</span>
      <button onclick="doLogout()" class="btn-sm btn-danger" style="margin-left:auto;">üö™ ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
    </div>

    <div class="dash-header">
      <div class="dash-title">üìã ‡¶ï‡ßá‡¶∏ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü
        <span id="fb-status" style="font-size:.68rem;font-family:var(--mono);color:var(--muted);font-weight:400;"></span>
      </div>
      <div class="dash-actions">
        <button class="btn-sm" onclick="loadCases()" id="refresh-btn">üîÑ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂</button>
        <button class="btn-sm" onclick="exportCsv()">üì• CSV ‡¶∞‡¶™‡ßç‡¶§‡¶æ‡¶®‡¶ø</button>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card"><div class="stat-num c-teal"  id="st-total">‚Äî</div><div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶ï‡ßá‡¶∏</div></div>
      <div class="stat-card"><div class="stat-num c-red"   id="st-crit">‚Äî</div><div class="stat-label">‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø</div></div>
      <div class="stat-card"><div class="stat-num c-amber" id="st-high">‚Äî</div><div class="stat-label">‡¶â‡¶ö‡ßç‡¶ö ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø</div></div>
      <div class="stat-card"><div class="stat-num c-yel"   id="st-active">‚Äî</div><div class="stat-label">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</div></div>
    </div>

    <div class="filter-row">
      <input type="text" class="filter-inp" id="search-inp"
             placeholder="üîç Case ID ‡¶¨‡¶æ ‡¶π‡ßÅ‡¶Æ‡¶ï‡¶ø‡¶∞ ‡¶ß‡¶∞‡¶® ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." oninput="filterCases()">
      <select class="filter-sel" id="risk-filter" onchange="filterCases()">
        <option value="">‡¶∏‡¶¨ ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø</option>
        <option value="CRITICAL">‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø</option>
        <option value="HIGH">‡¶â‡¶ö‡ßç‡¶ö</option>
        <option value="MEDIUM">‡¶Æ‡¶æ‡¶ù‡¶æ‡¶∞‡¶ø</option>
        <option value="LOW">‡¶®‡¶ø‡¶Æ‡ßç‡¶®</option>
      </select>
      <select class="filter-sel" id="status-filter" onchange="filterCases()">
        <option value="">‡¶∏‡¶¨ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</option>
        <option value="‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º">‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</option>
        <option value="‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ‡¶ß‡ßÄ‡¶®">‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ‡¶ß‡ßÄ‡¶®</option>
        <option value="‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</option>
        <option value="‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá">‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</option>
      </select>
    </div>

    <div class="cases-list" id="cases-list">
      <div class="loading-row"><span class="spin"></span>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
    </div>
  </div>
</main>

<script>
(function() {

const ADMIN_PASS = 'suraksha2026'; // ‚Üê ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡¶∂‡¶®‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®
let allCases = [];
let sessionStart = null;
let sessionInterval = null;

function doLogin() {
  const pw  = document.getElementById('pw-input').value;
  const err = document.getElementById('login-err');
  if(!pw) { err.textContent = '‚ö†Ô∏è ‡¶ï‡ßã‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®'; return; }
  if(pw !== ADMIN_PASS) {
    err.textContent = '‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶ï‡ßã‡¶°';
    document.getElementById('pw-input').value = '';
    setTimeout(() => err.textContent = '', 3000);
    return;
  }
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('dashboard').style.display   = 'block';
  document.getElementById('admin-pill').style.display  = 'flex';
  sessionStart = Date.now();
  sessionInterval = setInterval(() => {
    const s = Math.floor((Date.now() - sessionStart) / 1000);
    document.getElementById('session-timer').textContent =
      String(Math.floor(s/60)).padStart(2,'0') + ':' + String(s%60).padStart(2,'0');
  }, 1000);
  // Config check ‚Äî only warn if placeholder still present
  const scriptText = Array.from(document.querySelectorAll('script[type=module]')).map(s=>s.textContent).join('');
  if(scriptText.includes('YOUR_API_KEY') || scriptText.includes('YOUR_PROJECT_ID')) {
    document.getElementById('config-warn').style.display = 'block';
  }
  loadCases();
}
window.doLogin = doLogin;

function doLogout() {
  clearInterval(sessionInterval); allCases = [];
  document.getElementById('dashboard').style.display   = 'none';
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('admin-pill').style.display  = 'none';
  document.getElementById('pw-input').value = '';
  toast('üîí ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®');
}
window.doLogout = doLogout;

document.getElementById('pw-input').addEventListener('keydown', e => { if(e.key==='Enter') doLogin(); });

async function loadCases() {
  const btn  = document.getElementById('refresh-btn');
  const list = document.getElementById('cases-list');
  btn.innerHTML = '<span class="spin"></span>‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...'; btn.disabled = true;
  list.innerHTML = '<div class="loading-row"><span class="spin"></span>Firebase Firestore ‡¶•‡ßá‡¶ï‡ßá ‡¶ï‡ßá‡¶∏ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>';
  try {
    if(typeof window._fbLoadAll !== 'function') await new Promise(r => setTimeout(r, 1500));
    if(typeof window._fbLoadAll !== 'function') throw new Error('Firebase module ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø ‚Äî config ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®');
    allCases = await window._fbLoadAll();
    const ORDER = ['CRITICAL','HIGH','MEDIUM','LOW'];
    allCases.sort((a,b) => ORDER.indexOf(a.riskLevel) - ORDER.indexOf(b.riskLevel));
    document.getElementById('fb-status').textContent = `¬∑ ${allCases.length}‡¶ü‡¶ø ‡¶ï‡ßá‡¶∏`;
    renderCases(allCases); updateStats(allCases);
  } catch(e) {
    list.innerHTML = `<div class="loading-row" style="color:var(--red2);">
      ‚ùå ${e.message}<br>
      <span style="font-size:.75rem;color:var(--muted);">Firebase config ‡¶ì Firestore ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</span>
    </div>`;
  }
  btn.innerHTML = 'üîÑ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂'; btn.disabled = false;
}
window.loadCases = loadCases;

function updateStats(c) {
  document.getElementById('st-total').textContent  = c.length;
  document.getElementById('st-crit').textContent   = c.filter(x => x.riskLevel==='CRITICAL').length;
  document.getElementById('st-high').textContent   = c.filter(x => x.riskLevel==='HIGH').length;
  document.getElementById('st-active').textContent = c.filter(x => x.status==='‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º').length;
}

function filterCases() {
  const q = document.getElementById('search-inp').value.toLowerCase();
  const r = document.getElementById('risk-filter').value;
  const s = document.getElementById('status-filter').value;
  renderCases(allCases.filter(c =>
    (!q || c.caseId?.toLowerCase().includes(q) || (c.vTypes||[]).join(' ').toLowerCase().includes(q)) &&
    (!r || c.riskLevel === r) && (!s || c.status === s)
  ));
}
window.filterCases = filterCases;

function renderCases(cases) {
  if(!cases.length) {
    document.getElementById('cases-list').innerHTML = `<div class="empty-state"><span class="empty-icon">üì≠</span><div>‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßá‡¶∏ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</div></div>`;
    return;
  }
  const RL = { CRITICAL:'‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø', HIGH:'‡¶â‡¶ö‡ßç‡¶ö ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø', MEDIUM:'‡¶Æ‡¶æ‡¶ù‡¶æ‡¶∞‡¶ø', LOW:'‡¶®‡¶ø‡¶Æ‡ßç‡¶®' };
  document.getElementById('cases-list').innerHTML = cases.map(c => {
    const rl = (c.riskLevel||'LOW').toLowerCase();
    const stBadge = c.status==='‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'?'tb-resolved':c.status==='‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ‡¶ß‡ßÄ‡¶®'?'tb-review':c.status==='‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'?'tb-referred':'tb-active';
    let ts = '‚Äî';
    if(c.savedAt?.seconds) ts = new Date(c.savedAt.seconds*1000).toLocaleString('bn-BD');
    else if(c.timestamp) ts = c.timestamp;
    const vtags = (c.vTypes||[]).map(v=>`<span class="meta-tag">üî¥ ${v}</span>`).join('');
    const ptags = (c.platforms||[]).map(p=>`<span class="meta-tag">üì± ${p}</span>`).join('');
    return `
    <div class="case-card ${rl}">
      <div class="case-hdr">
        <span class="case-id">${c.caseId}</span>
        <span class="rl-${rl}">${c.riskLabel||RL[c.riskLevel]||c.riskLevel}</span>
        <span class="${stBadge}">${c.status}</span>
        <span class="case-ts">${ts}</span>
      </div>
      <div class="case-meta">${vtags}${ptags}<span class="meta-tag">üìé ${c.evidenceCount||0}‡¶ü‡¶ø</span></div>
      <div class="case-footer">
        <select class="status-sel" onchange="updStatus('${c.caseId}',this.value)">
          <option ${c.status==='‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º'?'selected':''}>‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º</option>
          <option ${c.status==='‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ‡¶ß‡ßÄ‡¶®'?'selected':''}>‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶≤‡ßã‡¶ö‡¶®‡¶æ‡¶ß‡ßÄ‡¶®</option>
          <option ${c.status==='‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'?'selected':''}>‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</option>
          <option ${c.status==='‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'?'selected':''}>‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</option>
        </select>
        <button class="btn-sm btn-danger" onclick="deleteCase('${c.caseId}')">üóë ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
      </div>
    </div>`;
  }).join('');
}

async function updStatus(caseId, status) {
  try {
    await window._fbUpdateStatus(caseId, status);
    const c = allCases.find(x => x.caseId===caseId);
    if(c) c.status = status;
    updateStats(allCases);
    toast(`‚úÖ ${caseId} ‚Üí ${status}`);
  } catch(e) { toast('‚ö†Ô∏è ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ'); }
}
window.updStatus = updStatus;

async function deleteCase(caseId) {
  if(!confirm(`‡¶ï‡ßá‡¶∏ ${caseId} ‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?`)) return;
  try {
    await window._fbDeleteCase(caseId);
    allCases = allCases.filter(c => c.caseId!==caseId);
    renderCases(allCases); updateStats(allCases);
    toast(`üóë ${caseId} ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶ó‡ßá‡¶õ‡ßá`);
  } catch(e) { toast('‚ö†Ô∏è ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'); }
}
window.deleteCase = deleteCase;

function exportCsv() {
  if(!allCases.length) { toast('‚ö†Ô∏è ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßá‡¶∏ ‡¶®‡ßá‡¶á'); return; }
  const H = ['Case ID','Risk Level','Risk Label','Status','V-Types','Platforms','Evidence Count','Saved At'];
  const rows = allCases.map(c => {
    const ts = c.savedAt?.seconds ? new Date(c.savedAt.seconds*1000).toISOString() : (c.timestamp||'');
    return [c.caseId,c.riskLevel,c.riskLabel||'',c.status,
      (c.vTypes||[]).join(';'),(c.platforms||[]).join(';'),c.evidenceCount||0,ts
    ].map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',');
  });
  const csv  = [H.join(','),...rows].join('\n');
  const blob = new Blob(['\uFEFF'+csv],{type:'text/csv;charset=utf-8;'});
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href=url; a.download='suraksha_cases_'+new Date().toISOString().slice(0,10)+'.csv';
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
  URL.revokeObjectURL(url);
  toast('üì• CSV ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá');
}
window.exportCsv = exportCsv;

function toast(msg) {
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('on');
  setTimeout(()=>t.classList.remove('on'),2600);
}
})();
</script>
</body>
</html>
